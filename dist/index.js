!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PostMessageHandler=t():e.PostMessageHandler=t()}(self,(()=>(()=>{"use strict";var e={16:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=r(736),s=r(164);t.default=function(e,t,r,n){if((0,i.default)(e,"addEventListener"))return e.addEventListener(t,r,n),function(){e.removeEventListener(t,r,n)};if((0,i.default)(e,"attachEvent")){var o="on"+t;return e.attachEvent(o,r),function(){e.detachEvent(o,r)}}return s.default}},572:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TargetOriginMissingError=void 0;var r=function(e){function t(t){var r=e.call(this,"`target` is `window` like which requires an `targetOrigin`, but no `targetOrigin` is set")||this;return r.target=t,r.name="TargetOriginMissingError",r}return __extends(t,e),t}(Error);t.TargetOriginMissingError=r},164:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){}},736:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(null!=e)try{return t in e}catch(r){return void 0!==e[t]}return!1}}},t={};function r(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}var i={};return(()=>{var e=i,t=r(16),s=r(164),n=r(572),o=function(){function e(e,t,r){var i=this;if(this.messageListener=[],this.listenerRegistered=!1,this.isWindow=t.self===t&&t.window===t&&"object"==typeof t.document,this.isWindow&&"string"!=typeof r)throw new n.TargetOriginMissingError(t);this.targetOrigin=r,this.secret=e,this.target=t,this.eventCallback=function(e){i.handleMessage(e)}}return e.prototype.subscribe=function(e){var r=this;return this.listenerRegistered||(this.listenerRegistered=!0,this.removeMessageListener=(0,t.default)(this.target,"message",this.eventCallback,!1)),"function"==typeof e?(this.messageListener.push(e),function(){r.unsubscribe(e)}):s.default},e.prototype.unsubscribe=function(e){var t=this.messageListener.indexOf(e);-1!==t&&this.messageListener.splice(t,1),this.listenerRegistered&&0===this.messageListener.length&&(this.listenerRegistered=!1,this.removeMessageListener())},e.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return this.isWindow?this.target.postMessage(this.secret+JSON.stringify(e),this.targetOrigin):this.target.postMessage(this.secret+JSON.stringify(e)),!0}catch(e){return!1}},e.prototype.handleMessage=function(e){if(this.checkEventOrigin(e.origin,e.source)){var t=e.message?"message":"data";if("string"!=typeof e[t])return;e[t].slice(0,this.secret.length)===this.secret&&this.callListener(JSON.parse(e[t].slice(this.secret.length)))}},e.prototype.checkEventOrigin=function(e,t){return e===this.targetOrigin&&t===this.target},e.prototype.callListener=function(e){for(var t=this.messageListener.length,r=0;r<t;r++)this.messageListener[r].apply(void 0,e)},e}();e.default=o})(),i.default})()));